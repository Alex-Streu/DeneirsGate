@using DeneirsGate.Services
@using CustomHtmlHelpers
@model LoginViewModel
@{
    ViewBag.Title = "Log In";
}

@section Css {
    <style type="text/css">
        body {
            background-color: #000;
        }
    </style>
}

<div id="login-page">
    <div class="container">
        <div class="login-title responsive-text" style="--size:8vw">DENEIR'S <span>GATE</span></div>
        @using (Html.BeginForm("Login", "Account", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-login", role = "form" }))
        {
            @Html.AntiForgeryToken()
            <h2 class="form-login-heading">Enter The Gate</h2>
            <div class="login-wrap">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                @HtmlHelpers.RenderFancyTextbox("md", "Username", null, null, Html.DisplayNameFor(m => m.Username).ToString(), Html.ValidationMessageFor(m => m.Username, "", new { @class = "text-danger" }))
                <br>
                @HtmlHelpers.RenderFancyPassword("md", "Password", null, null, Html.DisplayNameFor(m => m.Password).ToString(), Html.ValidationMessageFor(m => m.Password, "", new { @class = "text-danger" }))
                <div class="flex-container space-between">
                    <div>
                        @Html.CheckBoxFor(m => m.RememberMe)
                        @Html.LabelFor(m => m.RememberMe)
                    </div>
                    <label class="checkbox">
                        <a class="link red" data-toggle="modal" href="#forgotPasswordModal"> Forgot Password?</a>
                    </label>
                </div>
                <button class="btn btn-default btn-block" type="submit"><i class="fa fa-lock"></i> SIGN IN</button>
                <hr>
                <div class="login-social-link centered">
                    <p>or you can sign in via your social network</p>
                    <button class="btn btn-facebook" type="submit"><i class="fa fa-facebook"></i> Facebook</button>
                    <button class="btn btn-twitter" type="submit"><i class="fa fa-twitter"></i> Twitter</button>
                </div>
                <div class="registration">
                    Don't have an account yet?<br />
                    <a class="link red" href="@Url.Action("Register")">
                        Create an account
                    </a>
                </div>
            </div>
            <!-- Modal -->
            <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="forgotPasswordModal" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Forgot Password?</h4>
                        </div>
                        <div class="modal-body">
                            <p>Enter your e-mail address below to reset your password.</p>
                            <p class="red" id="forgotResponse"></p>
                            <input type="text" id="forgotEmail" name="email" placeholder="Email" autocomplete="off" class="form-control placeholder-no-fix">
                        </div>
                        <div class="modal-footer">
                            <button data-dismiss="modal" class="btn btn-default" type="button">Cancel</button>
                            <button id="forgotSubmit" class="btn btn-theme" type="button">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- modal -->
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">
        var forgotPasswordAction = '@Url.Action("ForgotPassword")';

        $.backstretch("@Url.Content("~/Content/img/login-background.jpg")", {
            speed: 500
        });

        $('#forgotSubmit').click(function () {
            var postData = {
                Email: $('#forgotEmail').val()
            }

            $.ajax({
                type: "POST",
                url: forgotPasswordAction,
                data: JSON.stringify(postData),
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    $('#forgotResponse').text(data.message);
                },
                error: function (error) {
                    $('#forgotResponse').text(error.responseText);
                }
            })
        })
    </script>
}